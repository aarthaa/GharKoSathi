{% extends 'main/base.html' %}

{% block content %}
<body>
  <div id="products">
    {% for key, value in request.session.cart.items %}
    <div class="product" style="border: 1px solid #ccc; padding: 10px; margin-bottom: 20px; background-color: #f9f9f9;">
      <h5>{{ value.name | truncatewords:10 }}</h5>
      <img src="{{ value.image }}" width="120" height="100">

      <p>Price: ₹{{ value.price }}</p>
      <button class="add-to-cart-btn" data-product="{{ key }}" data-name="{{ value.name }}" data-price="{{ value.price }}" style="padding: 5px 10px; background-color: #007bff; color: #fff; border: none; cursor: pointer;">Add to Cart</button>
    </div>
    {% endfor %}
  </div>
  <div id="cart" style="border: 1px solid #ccc; padding: 10px; margin-top: 20px; background-color: #f9f9f9;">
    <h2>Cart</h2>
    <ul id="cart-items" style="list-style-type: none; padding: 0;"></ul>
    <p>Total: <span id="cart-total">₹0.00</span></p>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const addToCartBtns = document.querySelectorAll('.add-to-cart-btn');
      const cartItemsList = document.getElementById('cart-items');
      const cartTotal = document.getElementById('cart-total');

      let totalPrice = 0;

      addToCartBtns.forEach(function(btn) {
        btn.addEventListener('click', function() {
          const productId = btn.getAttribute('data-product');
          const productName = btn.getAttribute('data-name');
          const productPrice = parseFloat(btn.getAttribute('data-price'));

          const listItem = document.createElement('li');
          const deleteButton = document.createElement('button');
          deleteButton.textContent = 'Delete';
          deleteButton.style.marginLeft = '10px';
          deleteButton.onclick = function() {
            cartItemsList.removeChild(listItem);
            totalPrice -= productPrice;
            cartTotal.textContent = `₹${totalPrice.toFixed(2)}`;
          };
          listItem.textContent = `${productName} - ₹${productPrice.toFixed(2)}`;
          listItem.appendChild(deleteButton);
          cartItemsList.appendChild(listItem);
          totalPrice += productPrice;
          cartTotal.textContent = `₹${totalPrice.toFixed(2)}`;
        });
      });
    });
  </script>
</body>
{% endblock %}
